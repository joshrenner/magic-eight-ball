<polymer-element name="magic-eight-ball" attributes="outlook">
    <template>
        <style>
            :host {
                border: 1px solid #ddd;
                text-align: center;
                display: inline-block;
            }
            :host > img {
                display: block;
                cursor: pointer;
            }

            @keyframes shake {
                0% { transform: translate(6px, 0); }
                50% { transform: translate(-6px, 0); }
                100% { transform: translate(0, 0); }
            }
            @-moz-keyframes shake {
                0% { -moz-transform: translate(6px, 0); }
                50% { -moz-transform: translate(-6px, 0); }
                100% { -moz-transform: translate(0, 0); }
            }
            @-webkit-keyframes shake {
                0% { -webkit-transform: translate(6px, 0); }
                50% { -webkit-transform: translate(-6px, 0); }
                100% { -webkit-transform: translate(0, 0); }
            }

            :host > img:active {
                cursor: ew-resize;
                animation: shake 100ms infinite ease-in-out;
                -moz-animation: shake 100ms infinite ease-in-out;
                -webkit-animation: shake 100ms infinite ease-in-out;
            }
        </style>

        <h1 id="prediction">{{prediction}}</h1>
        <img id="ball" src="img/magic-8-ball.jpg"/>
    </template>
    <script>
        (function() {
            function random(o) {
                return o[Math.floor(Math.random() * o.length)];
            }
            function shuffle(o) {
                for(var j, x, i = o.length; i; j = parseInt(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
                return o;
            }
            function shrink(o) {
                return shuffle(o).splice(0, Math.floor(o.length / 2));
            }

            Polymer("magic-eight-ball", {
                outlook: 0,
                prediction: "Ask me a question",
                domReady: function () {
                    this.$.ball.addEventListener("mouseup", this.predict.bind(this));
                },
                predict: function () {
                    this.$.prediction.innerHTML = random(this.getOptions());
                },
                getOptions: function () {
                    var options = this.children,
                        optimistic = [], pessimistic = [], list = [];

                    for(var n=0; n<options.length; n++){
                        var item = options[n],
                            outlook = item.getAttribute("outlook"),
                            text = item.innerHTML;

                        if (text === this.$.prediction.innerHTML)
                            continue;

                        if (outlook > 0)
                            optimistic.push(text);
                        else if (outlook < 0)
                            pessimistic.push(text);
                        else
                            list.push(text);
                    }

                    if (this.outlook > 0)
                        pessimistic = shrink(pessimistic);
                    if (this.outlook < 0)
                        optimistic = shrink(optimistic);

                    return list.concat(optimistic).concat(pessimistic);
                }
            })
        })();
    </script>
</polymer-element>